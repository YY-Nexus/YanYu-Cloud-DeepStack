# ç¯å¢ƒå˜é‡é…ç½®æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†è¨€èªäº‘Â³ æ·±åº¦å †æ ˆå…¨æ ˆæ™ºåˆ›å¼•æ“æ‰€éœ€çš„æ‰€æœ‰ç¯å¢ƒå˜é‡é…ç½®ã€‚

## ğŸš€ å¿«é€Ÿé…ç½®

### æœ€å°é…ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

\`\`\`bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶
cp .env.example .env.local

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env.local
\`\`\`

**æœ€å°å¿…éœ€é…ç½®ï¼š**
\`\`\`env
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-here
NEXT_PUBLIC_OLLAMA_URL=http://localhost:11434
\`\`\`

### ç”Ÿäº§ç¯å¢ƒé…ç½®

**å¿…éœ€é…ç½®é¡¹ï¼š**
\`\`\`env
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.com
NEXTAUTH_SECRET=your-production-secret-key
KV_REST_API_URL=your-redis-url
KV_REST_API_TOKEN=your-redis-token
\`\`\`

## ğŸ“š é…ç½®åˆ†ç±»è¯¦è§£

### 1. åŸºç¡€åº”ç”¨é…ç½®

| å˜é‡å | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|------|
| `NODE_ENV` | string | âœ… | development | åº”ç”¨è¿è¡Œç¯å¢ƒ |
| `NEXT_PUBLIC_APP_URL` | string | âœ… | http://localhost:3000 | åº”ç”¨è®¿é—®åœ°å€ |
| `NEXT_PUBLIC_APP_NAME` | string | âŒ | YanYu CloudÂ³ DeepStack | åº”ç”¨åç§° |
| `NEXT_PUBLIC_APP_VERSION` | string | âŒ | 1.0.0 | åº”ç”¨ç‰ˆæœ¬ |

### 2. AI æœåŠ¡é…ç½®

| å˜é‡å | ç±»å‹ | å¿…éœ€ | è¯´æ˜ |
|--------|------|------|------|
| `NEXT_PUBLIC_OLLAMA_URL` | string | ğŸ”¶ | Ollama æœåŠ¡åœ°å€ |
| `OPENAI_API_KEY` | string | âŒ | OpenAI API å¯†é’¥ |
| `XAI_API_KEY` | string | âŒ | xAI (Grok) API å¯†é’¥ |
| `GROQ_API_KEY` | string | âŒ | Groq API å¯†é’¥ |
| `FAL_KEY` | string | âŒ | Fal AI API å¯†é’¥ |

**é…ç½®è¯´æ˜ï¼š**
- ğŸ”¶ è¡¨ç¤ºæ¨èé…ç½®ï¼Œä¸é…ç½®å°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
- è‡³å°‘é…ç½®ä¸€ä¸ª AI æœåŠ¡ä»¥è·å¾—å®Œæ•´åŠŸèƒ½

### 3. å¤–éƒ¨ API æœåŠ¡

| æœåŠ¡ç±»å‹ | å˜é‡å | è·å–æ–¹å¼ | è¯´æ˜ |
|----------|--------|----------|------|
| å¤©æ°”æœåŠ¡ | `OPENWEATHER_API_KEY` | [OpenWeatherMap](https://openweathermap.org/api) | å…è´¹é¢åº¦ï¼š1000æ¬¡/å¤© |
| æ–°é—»æœåŠ¡ | `NEWS_API_KEY` | [NewsAPI](https://newsapi.org/) | å…è´¹é¢åº¦ï¼š1000æ¬¡/å¤© |
| IPæŸ¥è¯¢ | `IPINFO_TOKEN` | [IPInfo](https://ipinfo.io/) | å…è´¹é¢åº¦ï¼š50000æ¬¡/æœˆ |
| è‚¡ç¥¨æ•°æ® | `ALPHA_VANTAGE_API_KEY` | [Alpha Vantage](https://www.alphavantage.co/) | å…è´¹é¢åº¦ï¼š5æ¬¡/åˆ†é’Ÿ |
| åœ°ç†ç¼–ç  | `GOOGLE_MAPS_API_KEY` | [Google Cloud](https://cloud.google.com/maps-platform) | æŒ‰ä½¿ç”¨é‡è®¡è´¹ |
| ç¿»è¯‘æœåŠ¡ | `GOOGLE_TRANSLATE_API_KEY` | [Google Cloud](https://cloud.google.com/translate) | æŒ‰ä½¿ç”¨é‡è®¡è´¹ |

### 4. æ•°æ®åº“å’Œç¼“å­˜

| å˜é‡å | æœåŠ¡å•† | å¿…éœ€ | è¯´æ˜ |
|--------|--------|------|------|
| `KV_REST_API_URL` | Upstash | ğŸ”¶ | Redis ç¼“å­˜æœåŠ¡åœ°å€ |
| `KV_REST_API_TOKEN` | Upstash | ğŸ”¶ | Redis ç¼“å­˜æœåŠ¡ä»¤ç‰Œ |
| `DATABASE_URL` | Neon/Supabase | âŒ | PostgreSQL æ•°æ®åº“è¿æ¥ |
| `NEXT_PUBLIC_SUPABASE_URL` | Supabase | âŒ | Supabase é¡¹ç›®åœ°å€ |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | Supabase | âŒ | Supabase åŒ¿åå¯†é’¥ |

**Upstash Redis é…ç½®æ­¥éª¤ï¼š**
1. è®¿é—® [Upstash Console](https://console.upstash.com/)
2. åˆ›å»ºæ–°çš„ Redis æ•°æ®åº“
3. å¤åˆ¶ REST API URL å’Œ Token
4. é…ç½®åˆ°ç¯å¢ƒå˜é‡ä¸­

### 5. è®¤è¯å’Œå®‰å…¨

| å˜é‡å | å¿…éœ€ | ç”Ÿæˆæ–¹å¼ | è¯´æ˜ |
|--------|------|----------|------|
| `NEXTAUTH_SECRET` | âœ… | `openssl rand -base64 32` | NextAuth.js å¯†é’¥ |
| `JWT_SECRET` | âŒ | `openssl rand -base64 32` | JWT ç­¾åå¯†é’¥ |
| `API_KEY_SALT` | âŒ | `openssl rand -base64 16` | API å¯†é’¥ç›å€¼ |

**OAuth é…ç½®ï¼š**
\`\`\`env
# GitHub OAuth
GITHUB_CLIENT_ID=your_github_client_id
GITHUB_CLIENT_SECRET=your_github_client_secret

# Google OAuth
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
\`\`\`

### 6. ç›‘æ§å’Œåˆ†æ

| æœåŠ¡ | å˜é‡å | è·å–æ–¹å¼ |
|------|--------|----------|
| Sentry | `SENTRY_DSN` | [Sentry.io](https://sentry.io/) |
| Google Analytics | `NEXT_PUBLIC_GA_MEASUREMENT_ID` | [Google Analytics](https://analytics.google.com/) |
| Vercel Analytics | `NEXT_PUBLIC_VERCEL_ANALYTICS_ID` | [Vercel Dashboard](https://vercel.com/analytics) |
| PostHog | `NEXT_PUBLIC_POSTHOG_KEY` | [PostHog](https://posthog.com/) |

## ğŸ”§ é…ç½®å·¥å…·

### ç¯å¢ƒå˜é‡éªŒè¯è„šæœ¬

\`\`\`bash
#!/bin/bash
# scripts/validate-env.sh

echo "ğŸ” éªŒè¯ç¯å¢ƒå˜é‡é…ç½®..."

# æ£€æŸ¥å¿…éœ€å˜é‡
required_vars=(
  "NODE_ENV"
  "NEXT_PUBLIC_APP_URL"
  "NEXTAUTH_SECRET"
)

for var in "${required_vars[@]}"; do
  if [ -z "${!var}" ]; then
    echo "âŒ ç¼ºå°‘å¿…éœ€ç¯å¢ƒå˜é‡: $var"
    exit 1
  else
    echo "âœ… $var å·²é…ç½®"
  fi
done

echo "ğŸ‰ ç¯å¢ƒå˜é‡éªŒè¯é€šè¿‡ï¼"
\`\`\`

### é…ç½®ç”Ÿæˆå™¨

\`\`\`javascript
// scripts/generate-env.js
const crypto = require('crypto');
const fs = require('fs');

function generateSecret(length = 32) {
  return crypto.randomBytes(length).toString('base64');
}

const envConfig = `
# è‡ªåŠ¨ç”Ÿæˆçš„ç¯å¢ƒå˜é‡é…ç½®
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXTAUTH_SECRET=${generateSecret()}
JWT_SECRET=${generateSecret()}
API_KEY_SALT=${generateSecret(16)}

# è¯·æ‰‹åŠ¨é…ç½®ä»¥ä¸‹å˜é‡
# NEXT_PUBLIC_OLLAMA_URL=http://localhost:11434
# OPENAI_API_KEY=your_openai_key_here
`;

fs.writeFileSync('.env.local', envConfig.trim());
console.log('âœ… ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶å·²ç”Ÿæˆ: .env.local');
\`\`\`

## ğŸš€ éƒ¨ç½²é…ç½®

### Vercel éƒ¨ç½²

1. **åœ¨ Vercel Dashboard ä¸­é…ç½®ç¯å¢ƒå˜é‡**
2. **ç”Ÿäº§ç¯å¢ƒå¿…éœ€å˜é‡ï¼š**
   \`\`\`
   NODE_ENV=production
   NEXT_PUBLIC_APP_URL=https://your-domain.vercel.app
   NEXTAUTH_SECRET=your-production-secret
   \`\`\`

### Docker éƒ¨ç½²

\`\`\`dockerfile
# Dockerfile
FROM node:18-alpine

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV NODE_ENV=production
ENV NEXT_PUBLIC_APP_URL=http://localhost:3000

# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
COPY .env.production .env.local

# ... å…¶ä»–æ„å»ºæ­¥éª¤
\`\`\`

### ç¯å¢ƒå˜é‡ç®¡ç†å·¥å…·

**æ¨èå·¥å…·ï¼š**
- [Doppler](https://doppler.com/) - ä¼ä¸šçº§å¯†é’¥ç®¡ç†
- [Infisical](https://infisical.com/) - å¼€æºå¯†é’¥ç®¡ç†
- [AWS Secrets Manager](https://aws.amazon.com/secrets-manager/) - AWS å¯†é’¥ç®¡ç†
- [Azure Key Vault](https://azure.microsoft.com/services/key-vault/) - Azure å¯†é’¥ç®¡ç†

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

### 1. å¯†é’¥ç®¡ç†
- âœ… ä½¿ç”¨å¼ºéšæœºå¯†é’¥
- âœ… å®šæœŸè½®æ¢ API å¯†é’¥
- âœ… ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å·¥å…·

### 2. æƒé™æ§åˆ¶
- âœ… æœ€å°æƒé™åŸåˆ™
- âœ… åˆ†ç¦»å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
- âœ… å®šæœŸå®¡è®¡ API ä½¿ç”¨æƒ…å†µ

### 3. ç›‘æ§å’Œå‘Šè­¦
- âœ… é…ç½® API ä½¿ç”¨é‡ç›‘æ§
- âœ… è®¾ç½®å¼‚å¸¸è®¿é—®å‘Šè­¦
- âœ… è®°å½•æ•æ„Ÿæ“ä½œæ—¥å¿—

## ğŸ› å¸¸è§é—®é¢˜

### Q: Ollama è¿æ¥å¤±è´¥
**A:** æ£€æŸ¥ä»¥ä¸‹é…ç½®ï¼š
\`\`\`bash
# ç¡®ä¿ Ollama æœåŠ¡æ­£åœ¨è¿è¡Œ
ollama serve

# æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®
NEXT_PUBLIC_OLLAMA_URL=http://localhost:11434

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
\`\`\`

### Q: å¤–éƒ¨ API è¿”å› 401 é”™è¯¯
**A:** æ£€æŸ¥ API å¯†é’¥é…ç½®ï¼š
\`\`\`bash
# éªŒè¯å¯†é’¥æ ¼å¼
echo $OPENAI_API_KEY | wc -c

# æ£€æŸ¥å¯†é’¥æƒé™
curl -H "Authorization: Bearer $OPENAI_API_KEY" https://api.openai.com/v1/models
\`\`\`

### Q: ç¼“å­˜æœåŠ¡è¿æ¥å¤±è´¥
**A:** éªŒè¯ Redis é…ç½®ï¼š
\`\`\`bash
# æµ‹è¯•è¿æ¥
curl -X GET "$KV_REST_API_URL/ping" \
  -H "Authorization: Bearer $KV_REST_API_TOKEN"
\`\`\`

### Q: ç”Ÿäº§ç¯å¢ƒé…ç½®ä¸ç”Ÿæ•ˆ
**A:** æ£€æŸ¥ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§ï¼š
1. `.env.local` (æœ€é«˜ä¼˜å…ˆçº§)
2. `.env.production`
3. `.env`
4. `.env.example` (æœ€ä½ä¼˜å…ˆçº§)

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. **æŸ¥çœ‹æ—¥å¿—è¾“å‡º**
2. **æ£€æŸ¥ç¯å¢ƒå˜é‡æ‹¼å†™**
3. **éªŒè¯ API å¯†é’¥æœ‰æ•ˆæ€§**
4. **æäº¤ Issue** åˆ°é¡¹ç›®ä»“åº“

---

**é…ç½®å®Œæˆåï¼Œè¯·è¿è¡Œ `npm run dev` å¯åŠ¨å¼€å‘æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ï¼** ğŸš€
